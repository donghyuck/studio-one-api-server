logging:
  level:
    root: error
    jdk: error
    studio.one: error
    studio.server: error
    org: info
    org.springframework.boot.context.properties: DEBUG
    org.springframework.boot.context.properties.bind: DEBUG
    org.springframework.boot.autoconfigure: DEBUG
    org.springframework.security: TRACE
    org.springframework.security.authentication: TRACE
    org.springframework.security.authentication.dao: TRACE
    org.springframework.security.web: TRACE
    org.springframework.security.web.FilterChainProxy: TRACE
    org.hibernate: ERROR
    dev.langchain4j: DEBUG
    com.zaxxer.hikari: ERROR
    log4jdbc.log4j2: DEBUG
    org.springframework.security.access.intercept.aopalliance.MethodSecurityInterceptor: DEBUG
    org.springframework.security.access.expression.method: DEBUG
spring:
  application:
    name: cufit
  flyway:
    enabled: false
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: true
    sql-migration-prefix: V
    repeatable-sql-migration-prefix: R
    sql-migration-separator: __
    sql-migration-suffixes: .sql
    locations: 
      - classpath:/schema/data/postgres
      - classpath:/schema/objecttype/postgres
      - classpath:/schema/user/postgres
      - classpath:/schema/security/postgres
      - classpath:/schema/security-acl/postgres
      - classpath:/schema/ai/postgres
      - classpath:/schema/avatar/postgres
      - classpath:/schema/attachment/postgres
      - classpath:/schema/template/postgres
      - classpath:/schema/mail/postgres
    out-of-order: true
  ### JPA Config ###
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQL10Dialect
    show-sql: false
    properties:
      hibernate:
        default_schema: studioapi
        format_sql: true
        jdbc:
          time_zone: UTC
    hibernate:
      ddl-auto: validate
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
  ### DATASOURCE Config ###
  datasource:
    primary:
      url: jdbc:log4jdbc:postgresql://localhost:5432/cufit_db
      driver-class-name: net.sf.log4jdbc.sql.jdbcapi.DriverSpy
      username: studioapi
      password: studioapi
      type: com.zaxxer.hikari.HikariDataSource
      hikari:
        minimum-idle: 5 # 최소 유휴 커넥션 수
        maximum-pool-size: 5 # 커넥션 풀 최대 크기 (일반 웹서비스 기준)
        idle-timeout: 600000 # 커넥션 유휴 종료 시간 (10분, 단위: ms)
        max-lifetime: 1800000 # 커넥션 최대 수명 (30분, 단위: ms)
        connection-timeout: 30000 # 커넥션 획득 timeout (30초)
        pool-name: PrimaryHikariCP # 풀 이름 지정
        auto-commit: false # 자동 커밋 여부
  mail:
    host: ${MAIL_HOST:localhost}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USER:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail.debug: true
      mail.smtp.auth: true
      mail.smtp.starttls.enable: true 
  servlet:
    multipart:
      max-file-size: 50MB      # 업로드 1개 파일 최대 크기
      max-request-size: 200MB  # 요청 전체(여러 파일 합) 최대 크기
      file-size-threshold: 0   # 0이면 디스크로 바로 저장(메모리에 안 쌓음)      
management:
  endpoints:
    web:
      exposure:
        include: mappings # 또는 "*"      
studio:
  banner-mode: off
  env:
    log:
      enabled: false
      print-values: false
  i18n:
    # resources:   # ← 비워두면 자동 스캔
    #   - classpath:i18n/*/messages
    #   - classpath:META-INF/i18n/user/messages
    encoding: UTF-8
    cache-seconds: -1
    use-code-as-default-message: true
    fallback-to-system-locale: false
  persistence:
    type: jdbc
  features:
    application-properties:
      enabled: true
    attachment:
      enabled: true 
      storage:
        baseDir: /Users/donghyuck.son/Documents/file
      web:
        enabled: true
        mgmt-base-path: /api/mgmt/files
    avatar-image:
      enabled: true 
      web:
        user-base: /api/mgmt/users
        public-base: /api/profile
      replica:
        base-dir: var/lib/app/avatars
        ensure-dirs: true
        cleanup:
          enabled: true
          cron: 0 0 3 * * *
          ttlDays: 30        
    document:
      enabled: true 
      web:
        enabled: true
        base-path: /api/mgmt/documents
    forums:
      enabled: true
      admin-role:
        ROLE_ADMIN,ADMIN 
      attachments:
        object-type: 1
      cache:
        enabled: true
        list-ttl: 60s
        detail-ttl: 5m
        list-max-size: 10000
        detail-max-size: 50000
        record-stats: true        
      web:
        enabled: true
        base-path: /api/forums    
        mgmt-base-path: /api/mgmt/forums
    jasypt:
      enabled: true
      encryptor:
        bean: components:foundation:jasypt-string-encryptor
        password: ${JASYPT_ENCRYPTOR_PASSWORD} # 환경 변수로 암호화 비밀번호 설정
        algorithm: "PBEWithSHA256And128BitAES-CBC-BC" # Bouncy Castle 알고리즘 사용
        providerName: "BC" # Bouncy Castle 프로바이더 지정
        key-obtention-iterations: 1000
        pool-size: 1
        salt-generator-classname: "org.jasypt.salt.RandomSaltGenerator"
        string-output-type: "base64"
      http:
        enabled: true # 웹 엔드포인트 사용 시 true
        base-path: /internal/jasypt
        require-token: true
        #token-env: JASYPT_HTTP_TOKEN
        token-value: local-dev-token
    mail:
      enabled: true
      imap:
        host: ${MAIL_HOST:localhost}
        port: 993
        username: ${MAIL_USER:}
        password: ${MAIL_PASSWORD:}
        protocol: imaps # 기본 imaps
        folder: helpdesk #INBOX
        max-messages: 500
        concurrency: 4 # 동시 처리 스레드 수
        max-attachment-bytes: 10485760 # 10MB 초과 첨부는 저장하지 않음
        max-body-bytes: 1048576 # 본문은 길이 제한으로 자름
      web:
        enabled: true
        base-path: /api/mgmt/mail
        notify: stomp
        stomp-destination: /mail-sync
    realtime:
      enabled: true
    template:
      enabled: true  
    text:
      enabled: true          
    user:
      enabled: true 
      web:
        enabled: true
    objecttype:
      enabled: true
      web:
        enabled: true
  objecttype:
    mode: db # yaml | db     
    registry:
      cache:
        enabled: true
        ttl-seconds: 300
        max-size: 1000
    policy:
      cache:
        enabled: true
        ttl-seconds: 300
        max-size: 1000    
  ai:
    enabled: true
    prompts:
      query-rewrite: "classpath:prompts/query-rewrite.v1.prompt"
      summarization: "classpath:prompts/summarization.v1.prompt"
      keyword-extraction: "classpath:prompts/keyword-extraction.v1.prompt"
      rag-cleaner: "classpath:prompts/rag-cleaner.v1.prompt"
    pipeline:
      chunk-size: 350
      chunk-overlap: 50
    endpoints:
      enabled: true
    default-provider: google-ai-gemini
    providers:
      google-ai-gemini:
        enabled: true
        type: google_ai_gemini
        api-key: ${GEMINI_API_KEY}
        chat:
          enabled: true
          model: gemini-2.0-flash
        embedding:
          enabled: true
          model: text-embedding-004
      google-ai-gemini-pro:
        enabled: true
        type: google_ai_gemini
        api-key: ${GEMINI_API_KEY}
        chat:
          enabled: true
          model: gemini-2.5-pro
  cloud:
    storage:
      web:
        enabled: true
        endpoint: /api/mgmt/objectstorage
      providers:
        naver_cufit:
          type: s3
          enabled: true
          region: kr-standard
          endpoint: https://kr.object.ncloudstorage.com
          credentials:
            access-key: ${S3_ACCESS_KEY}
            secret-key: ${S3_SECRET_KEY}
          s3:
            path-style: true
            presigner-enabled: true
  realtime:
    stomp:
      enabled: true
      endpoint: /ws
      app-destination-prefix: /app
      topic-prefix: /topic
      user-prefix: /user
      allowed-origins: # CORS 허용 오리진
        - "http://localhost:3000"
        - "http://192.168.0.156:3000"
      sock-js: false # SockJS fallback 사용 여부
      jwt-enabled: false # JwtDecoder 사용 시 true
      redis-enabled: false # Redis Pub/Sub 사용 시 true
      redis-channel: studio:realtime:events
  security:
    enabled: true
    acl:
      enabled: true   
      cache-name: aclCache
      admin-role: ROLE_ADMIN
      metrics-enabled: true
      audit-enabled: true
      defaults: 
        enabled: true
      sync:
        enabled: true
      web: 
        enabled: true 
        base-path: /api/security/acl    
    auth:
      lock:
        enabled: true
        maxAttempts: 5
        lockDuration: 5m
      password-reset:
        enabled: true
        reset-password-url: /password-reset
        web:
          enabled: true
          base-path: /api/auth/password-reset
    audit:
      login-failure:
        enabled: true
        web:
          enabled: true
    password-encoder:
      algorithm: BCRYPT
      bcrypt-strength: 10
    form-login:
      enabled: false
      login-page: /login
      login-processing-url: /login
      username-parameter: username
      password-parameter: password
      default-success-url: /
    logout:
      enabled: false
      logout-url: /logout
      logout-success-url: /login?logout
      invalidate-session: true
      delete-cookies: ["JSESSIONID"]
    jwt:
      enabled: true
      secret: rPdiCjP07o9Soenln4t58AZr5bgaTLpXllDbbRs6yZ0=
      access-ttl: 30m
      refresh-ttl: 35m
      issuer: www.cufit.go.kr
      header: Authorization
      prefix: Bearer
      claim-authorities: authorities
      endpoints:
        login-enabled: true
        refresh-enabled: true
        base-path: /api/auth
      permit:
        - /api/auth/**
      fail-if-missing: true
    cors:
      allowed-origins:
        - "http://localhost:3000"
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
      allowed-headers:
        - Authorization
        - Content-Type
        - If-Match
      exposed-headers:
        - Authorization
        - ETag
      allow-credentials: true
      max-age: 3600
    permit:
      permit-all:
        - /
        - /index.html
        - /api/auth/**
        - /api/users/*
        - /api/profile/*/avatar*
        - /api/forums/**
        - /api/forums/*/topics/*/posts/*/attachments*
        - /actuator/**
        - /ws/**
        - /error
